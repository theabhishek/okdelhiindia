from django.core.management.base import BaseCommand
from delhi_wiki.models import MetroLine, MetroStation

class Command(BaseCommand):
    help = 'Populate Delhi Metro stations and lines'

    def handle(self, *args, **kwargs):
        # Define metro lines
        metro_lines = {
            'Red Line': '#E11B22',
            'Yellow Line': '#F4D03F',
            'Blue Line': '#0052A5',
            'Green Line': '#85B716',
            'Violet Line': '#7B1FA2',
            'Pink Line': '#E91E63',
            'Magenta Line': '#CA4BC5',
            'Grey Line': '#999999',
            'Orange Line': '#FF9800',
            'Rapid Metro': '#1E8449',
            'Airport Express': '#FF6B00',
            'Aqua Line': '#00BCD4',  # Noida Metro
            'RapidX': '#FF5722',     # RRTS
        }

        # Create metro lines
        created_lines = {}
        for line_name, color in metro_lines.items():
            line, created = MetroLine.objects.get_or_create(
                name=line_name,
                defaults={'color': color}
            )
            created_lines[line_name] = line
            if created:
                self.stdout.write(f"Created metro line: {line_name}")

        # Define stations for each line with their coordinates
        stations_data = {
            'Red Line': [
                ('Rithala', 28.7199, 77.1024),
                ('Rohini West', 28.7141, 77.1118),
                ('Rohini East', 28.7134, 77.1228),
                ('Pitampura', 28.7037, 77.1313),
                ('Kohat Enclave', 28.6988, 77.1365),
                ('Netaji Subhash Place', 28.6959, 77.1526),
                ('Keshav Puram', 28.6880, 77.1615),
                ('Kanhaiya Nagar', 28.6825, 77.1677),
                ('Inderlok', 28.6728, 77.1702),
                ('Shastri Nagar', 28.6670, 77.1798),
                ('Pratap Nagar', 28.6655, 77.1902),
                ('Pulbangash', 28.6661, 77.1980),
                ('Tis Hazari', 28.6667, 77.2161),
                ('Kashmere Gate', 28.6675, 77.2288),
                ('Shastri Park', 28.6681, 77.2511),
                ('Seelampur', 28.6695, 77.2651),
                ('Welcome', 28.6720, 77.2789),
                ('Shahdara', 28.6730, 77.2907),
                ('Mansarovar Park', 28.6752, 77.3071),
                ('Jhilmil', 28.6765, 77.3157),
                ('Dilshad Garden', 28.6853, 77.3219),
            ],
            'Yellow Line': [
                ('Samaypur Badli', 28.7469, 77.1803),
                ('Rohini Sector 18,19', 28.7386, 77.1773),
                ('Haiderpur Badli Mor', 28.7297, 77.1642),
                ('Jahangirpuri', 28.7246, 77.1623),
                ('Adarsh Nagar', 28.7171, 77.1690),
                ('Azadpur', 28.7070, 77.1786),
                ('Model Town', 28.7016, 77.1927),
                ('GTB Nagar', 28.6972, 77.2067),
                ('Vishwa Vidyalaya', 28.6881, 77.2139),
                ('Vidhan Sabha', 28.6861, 77.2208),
                ('Civil Lines', 28.6781, 77.2262),
                ('Kashmere Gate', 28.6675, 77.2288),
                ('Chandni Chowk', 28.6586, 77.2302),
                ('Chawri Bazar', 28.6492, 77.2282),
                ('New Delhi', 28.6425, 77.2209),
                ('Rajiv Chowk', 28.6333, 77.2182),
                ('Patel Chowk', 28.6228, 77.2140),
                ('Central Secretariat', 28.6147, 77.2116),
                ('Udyog Bhawan', 28.6112, 77.2119),
                ('Lok Kalyan Marg', 28.5977, 77.2107),
                ('Jor Bagh', 28.5873, 77.2123),
                ('INA', 28.5751, 77.2097),
                ('AIIMS', 28.5684, 77.2074),
                ('Green Park', 28.5598, 77.2066),
                ('Hauz Khas', 28.5432, 77.2065),
                ('Malviya Nagar', 28.5297, 77.2062),
                ('Saket', 28.5205, 77.2015),
                ('Qutab Minar', 28.5138, 77.1870),
                ('Chhatarpur', 28.5074, 77.1743),
                ('Sultanpur', 28.5001, 77.1571),
                ('Ghitorni', 28.4947, 77.1495),
                ('Arjan Garh', 28.4808, 77.1262),
                ('Guru Dronacharya', 28.4819, 77.1024),
                ('Sikanderpur', 28.4800, 77.0919),
                ('MG Road', 28.4795, 77.0765),
                ('IFFCO Chowk', 28.4722, 77.0722),
                ('Huda City Centre', 28.4595, 77.0724),
            ],
            'Blue Line': [
                ('Dwarka Sector 21', 28.5523, 77.0587),
                ('Dwarka Sector 8', 28.5659, 77.0671),
                ('Dwarka Sector 9', 28.5712, 77.0644),
                ('Dwarka Sector 10', 28.5784, 77.0623),
                ('Dwarka Sector 11', 28.5858, 77.0597),
                ('Dwarka Sector 12', 28.5923, 77.0578),
                ('Dwarka Sector 13', 28.5977, 77.0565),
                ('Dwarka Sector 14', 28.6027, 77.0557),
                ('Dwarka', 28.6157, 77.0622),
                ('Dwarka Mor', 28.6198, 77.0716),
                ('Nawada', 28.6206, 77.0321),
                ('Uttam Nagar West', 28.6218, 77.0584),
                ('Uttam Nagar East', 28.6224, 77.0665),
                ('Janakpuri West', 28.6291, 77.0819),
                ('Janakpuri East', 28.6325, 77.0912),
                ('Tilak Nagar', 28.6352, 77.1020),
                ('Subhash Nagar', 28.6352, 77.1111),
                ('Tagore Garden', 28.6352, 77.1222),
                ('Rajouri Garden', 28.6352, 77.1278),
                ('Ramesh Nagar', 28.6352, 77.1389),
                ('Moti Nagar', 28.6565, 77.1530),
                ('Kirti Nagar', 28.6565, 77.1530),
                ('Shadipur', 28.6515, 77.1603),
                ('Patel Nagar', 28.6444, 77.1694),
                ('Rajendra Place', 28.6421, 77.1778),
                ('Karol Bagh', 28.6421, 77.1903),
                ('Jhandewalan', 28.6444, 77.2014),
                ('Ramakrishna Ashram Marg', 28.6343, 77.2106),
                ('Rajiv Chowk', 28.6333, 77.2182),
                ('Barakhamba Road', 28.6325, 77.2264),
                ('Mandi House', 28.6261, 77.2345),
                ('Supreme Court', 28.6222, 77.2403),
                ('Indraprastha', 28.6186, 77.2497),
                ('Yamuna Bank', 28.6186, 77.2700),
                ('Laxmi Nagar', 28.6308, 77.2775),
                ('Nirman Vihar', 28.6308, 77.2886),
                ('Preet Vihar', 28.6308, 77.2997),
                ('Karkarduma', 28.6469, 77.3075),
                ('Anand Vihar ISBT', 28.6469, 77.3164),
                ('Kaushambi', 28.6469, 77.3244),
                ('Vaishali', 28.6469, 77.3397),
                ('Botanical Garden', 28.5644, 77.3336),
                ('Golf Course', 28.5700, 77.3400),
                ('Noida City Centre', 28.5800, 77.3500),
                ('Noida Sector 34', 28.5800, 77.3600),
                ('Noida Sector 52', 28.5800, 77.3700),
                ('Noida Sector 61', 28.5800, 77.3800),
                ('Noida Sector 59', 28.5800, 77.3900),
                ('Noida Sector 62', 28.5800, 77.4000),
                ('Noida Electronic City', 28.5800, 77.4100),
            ],
            'Green Line': [
                ('Kirti Nagar', 28.6565, 77.1530),
                ('Satguru Ram Singh Marg', 28.6565, 77.1444),
                ('Ashok Park Main', 28.6719, 77.1694),
                ('Inderlok', 28.6728, 77.1702),
                ('Punjabi Bagh', 28.6728, 77.1611),
                ('Punjabi Bagh West', 28.6728, 77.1528),
                ('Shivaji Park', 28.6728, 77.1444),
                ('Madipur', 28.6728, 77.1361),
                ('Paschim Vihar East', 28.6728, 77.1278),
                ('Paschim Vihar West', 28.6728, 77.1194),
                ('Peera Garhi', 28.6728, 77.1111),
                ('Udyog Nagar', 28.6728, 77.1028),
                ('Surajmal Stadium', 28.6728, 77.0944),
                ('Nangloi', 28.6728, 77.0861),
                ('Nangloi Railway Station', 28.6728, 77.0778),
                ('Rajdhani Park', 28.6728, 77.0694),
                ('Mundka', 28.6728, 77.0611),
            ],
            'Violet Line': [
                ('Kashmere Gate', 28.6675, 77.2288),
                ('Lal Quila', 28.6561, 77.2410),
                ('Jama Masjid', 28.6506, 77.2384),
                ('Delhi Gate', 28.6414, 77.2384),
                ('ITO', 28.6289, 77.2384),
                ('Mandi House', 28.6261, 77.2345),
                ('Central Secretariat', 28.6147, 77.2116),
                ('Khan Market', 28.6033, 77.2267),
                ('Jawaharlal Nehru Stadium', 28.5908, 77.2333),
                ('Jangpura', 28.5831, 77.2384),
                ('Lajpat Nagar', 28.5717, 77.2384),
                ('Moolchand', 28.5644, 77.2333),
                ('Kailash Colony', 28.5553, 77.2333),
                ('Nehru Place', 28.5478, 77.2533),
                ('Kalkaji Mandir', 28.5478, 77.2584),
                ('Govind Puri', 28.5444, 77.2633),
                ('Harkesh Nagar Okhla', 28.5444, 77.2733),
                ('Jasola Apollo', 28.5389, 77.2833),
                ('Sarita Vihar', 28.5333, 77.2917),
                ('Mohan Estate', 28.5278, 77.2983),
                ('Tughlakabad', 28.5222, 77.3033),
                ('Badarpur Border', 28.5139, 77.3033),
                ('Sarai', 28.4972, 77.3033),
                ('NHPC Chowk', 28.4889, 77.3033),
                ('Mewla Maharajpur', 28.4806, 77.3033),
                ('Sector 28', 28.4722, 77.3033),
                ('Badkhal Mor', 28.4639, 77.3033),
                ('Faridabad Old', 28.4556, 77.3033),
                ('Neelam Chowk Ajronda', 28.4472, 77.3033),
                ('Bata Chowk', 28.4389, 77.3033),
                ('Escorts Mujesar', 28.4306, 77.3033),
                ('Sant Surdas (Sihi)', 28.4222, 77.3033),
                ('Raja Nahar Singh', 28.4139, 77.3033),
            ],
            'Pink Line': [
                ('Majlis Park', 28.7469, 77.1803),
                ('Azadpur', 28.7070, 77.1786),
                ('Shalimar Bagh', 28.7019, 77.1556),
                ('Netaji Subhash Place', 28.6959, 77.1526),
                ('Shakurpur', 28.6884, 77.1556),
                ('Punjabi Bagh West', 28.6728, 77.1528),
                ('ESI Hospital', 28.6514, 77.1528),
                ('Rajouri Garden', 28.6352, 77.1278),
                ('Maya Puri', 28.6352, 77.1194),
                ('Naraina Vihar', 28.6352, 77.1111),
                ('Delhi Cantt', 28.6352, 77.1028),
                ('Durgabai Deshmukh South Campus', 28.6352, 77.0944),
                ('Sir Vishweshwaraiah Moti Bagh', 28.6352, 77.0861),
                ('Bhikaji Cama Place', 28.6352, 77.0778),
                ('Sarojini Nagar', 28.6352, 77.0694),
                ('INA', 28.5751, 77.2097),
                ('South Extension', 28.5717, 77.2184),
                ('Lajpat Nagar', 28.5717, 77.2384),
                ('Vinobapuri', 28.5717, 77.2484),
                ('Ashram', 28.5717, 77.2584),
                ('Hazrat Nizamuddin', 28.5881, 77.2501),
                ('Mayur Vihar Phase-1', 28.6044, 77.2901),
                ('Mayur Vihar Pocket 1', 28.6044, 77.3001),
                ('Trilokpuri Sanjay Lake', 28.6044, 77.3101),
                ('Vinod Nagar East', 28.6244, 77.3201),
                ('Vinod Nagar', 28.6244, 77.3301),
                ('IP Extension', 28.6244, 77.3401),
                ('Anand Vihar ISBT', 28.6469, 77.3164),
                ('Karkarduma', 28.6469, 77.3075),
                ('Karkarduma Court', 28.6469, 77.2975),
                ('Krishna Nagar', 28.6469, 77.2875),
                ('East Azad Nagar', 28.6469, 77.2775),
                ('Welcome', 28.6720, 77.2789),
                ('Jaffrabad', 28.6820, 77.2789),
                ('Maujpur', 28.6920, 77.2789),
                ('Gokulpuri', 28.7020, 77.2789),
                ('Johri Enclave', 28.7120, 77.2789),
                ('Shiv Vihar', 28.7220, 77.2789),
            ],
            'Magenta Line': [
                ('Janakpuri West', 28.6291, 77.0819),
                ('Dabri Mor', 28.6091, 77.0819),
                ('Dashrathpuri', 28.5991, 77.0819),
                ('Palam', 28.5891, 77.0819),
                ('Sadar Bazaar Cantonment', 28.5791, 77.0819),
                ('Terminal 1 IGI Airport', 28.5591, 77.0819),
                ('Shankar Vihar', 28.5491, 77.0819),
                ('Vasant Vihar', 28.5391, 77.0819),
                ('Munirka', 28.5291, 77.0819),
                ('RK Puram', 28.5191, 77.0819),
                ('IIT Delhi', 28.5091, 77.0819),
                ('Hauz Khas', 28.5432, 77.2065),
                ('Panchsheel Park', 28.5332, 77.2165),
                ('Chirag Delhi', 28.5232, 77.2265),
                ('Greater Kailash', 28.5432, 77.2365),
                ('Nehru Enclave', 28.5432, 77.2465),
                ('Kalkaji Mandir', 28.5478, 77.2584),
                ('Okhla NSIC', 28.5378, 77.2684),
                ('Sukhdev Vihar', 28.5278, 77.2784),
                ('Jamia Millia Islamia', 28.5178, 77.2884),
                ('Okhla Vihar', 28.5078, 77.2984),
                ('Jasola Vihar Shaheen Bagh', 28.4978, 77.3084),
                ('Kalindi Kunj', 28.4878, 77.3184),
                ('Okhla Bird Sanctuary', 28.4778, 77.3284),
                ('Botanical Garden', 28.5644, 77.3336),
            ],
            'Grey Line': [
                ('Dwarka', 28.6157, 77.0622),
                ('Nangli', 28.6057, 77.0522),
                ('Najafgarh', 28.5957, 77.0422),
                ('Dhansa Bus Stand', 28.5857, 77.0322),
            ],
            'Airport Express': [
                ('New Delhi', 28.6425, 77.2209),
                ('Shivaji Stadium', 28.6325, 77.2109),
                ('Dhaula Kuan', 28.6225, 77.2009),
                ('Delhi Aerocity', 28.6125, 77.1909),
                ('IGI Airport', 28.5591, 77.0819),
                ('Dwarka Sector 21', 28.5523, 77.0587),
            ],
            'Rapid Metro': [
                ('Sector 55-56', 28.4500, 77.1000),
                ('Sector 54 Chowk', 28.4550, 77.1100),
                ('Sector 53-54', 28.4600, 77.1200),
                ('Sector 42-43', 28.4650, 77.1300),
                ('Phase 1', 28.4700, 77.1400),
                ('Sikanderpur', 28.4800, 77.0919),
                ('Phase 2', 28.4850, 77.0819),
                ('Phase 3', 28.4900, 77.0719),
                ('Moulsari Avenue', 28.4950, 77.0619),
                ('Cyber City', 28.5000, 77.0519),
            ],
            'Aqua Line': [  # Noida Metro
                ('Sector 51', 28.5800, 77.3600),
                ('Sector 50', 28.5800, 77.3700),
                ('Sector 76', 28.5800, 77.3800),
                ('Sector 101', 28.5800, 77.3900),
                ('Sector 81', 28.5800, 77.4000),
                ('NSEZ', 28.5800, 77.4100),
                ('Sector 83', 28.5800, 77.4200),
                ('Sector 137', 28.5800, 77.4300),
                ('Sector 142', 28.5800, 77.4400),
                ('Sector 143', 28.5800, 77.4500),
                ('Sector 144', 28.5800, 77.4600),
                ('Sector 145', 28.5800, 77.4700),
                ('Sector 146', 28.5800, 77.4800),
                ('Sector 147', 28.5800, 77.4900),
                ('Sector 148', 28.5800, 77.5000),
                ('Knowledge Park II', 28.5800, 77.5100),
                ('Pari Chowk', 28.5800, 77.5200),
                ('Alpha 1', 28.5800, 77.5300),
                ('Delta 1', 28.5800, 77.5400),
                ('GNIDA Office', 28.5800, 77.5500),
                ('Depot', 28.5800, 77.5600),
            ],
            'RapidX': [  # Delhi-Meerut RRTS
                ('Sahibabad', 28.6700, 77.3300),
                ('Ghaziabad', 28.6700, 77.3400),
                ('Guldhar', 28.6700, 77.3500),
                ('Duhai', 28.6700, 77.3600),
                ('Duhai Depot', 28.6700, 77.3700),
                ('Muradnagar', 28.6700, 77.3800),
                ('Modinagar South', 28.6700, 77.3900),
                ('Modinagar North', 28.6700, 77.4000),
                ('Meerut South', 28.6700, 77.4100),
                ('Partapur', 28.6700, 77.4200),
                ('Rithani', 28.6700, 77.4300),
                ('Shatabdi Nagar', 28.6700, 77.4400),
                ('Meerut Central', 28.6700, 77.4500),
                ('Meerut North', 28.6700, 77.4600),
                ('Modipuram', 28.6700, 77.4700),
                ('Meerut City', 28.6700, 77.4800),
            ],
        }

        # Create stations for each line
        for line_name, stations in stations_data.items():
            line = created_lines[line_name]
            for station_name, lat, lon in stations:
                station, created = MetroStation.objects.get_or_create(
                    name=station_name,
                    defaults={
                        'latitude': lat,
                        'longitude': lon,
                        'is_interchange': False  # Will be updated later
                    }
                )
                station.lines.add(line)
                if created:
                    self.stdout.write(f"Created station: {station_name}")

        # Set interchange stations
        interchange_stations = {
            'Rajiv Chowk': ['Blue Line', 'Yellow Line'],
            'Kashmere Gate': ['Red Line', 'Yellow Line', 'Violet Line'],
            'Central Secretariat': ['Yellow Line', 'Violet Line'],
            'Mandi House': ['Blue Line', 'Violet Line'],
            'Inderlok': ['Red Line', 'Green Line'],
            'Kirti Nagar': ['Blue Line', 'Green Line'],
            'Welcome': ['Red Line', 'Pink Line'],
            'Anand Vihar ISBT': ['Blue Line', 'Pink Line'],
            'Karkarduma': ['Blue Line', 'Pink Line'],
            'Azadpur': ['Yellow Line', 'Pink Line'],
            'Netaji Subhash Place': ['Red Line', 'Pink Line'],
            'Rajouri Garden': ['Blue Line', 'Pink Line'],
            'INA': ['Yellow Line', 'Pink Line'],
            'Lajpat Nagar': ['Violet Line', 'Pink Line'],
            'Hauz Khas': ['Yellow Line', 'Magenta Line'],
            'Kalkaji Mandir': ['Violet Line', 'Magenta Line'],
            'Janakpuri West': ['Blue Line', 'Magenta Line'],
            'Dwarka': ['Blue Line', 'Grey Line'],
            'New Delhi': ['Yellow Line', 'Airport Express'],
            'Dwarka Sector 21': ['Blue Line', 'Airport Express'],
            'Sikanderpur': ['Yellow Line', 'Rapid Metro'],
            'Botanical Garden': ['Blue Line', 'Magenta Line', 'Aqua Line'],
            'Sector 51': ['Blue Line', 'Aqua Line'],
        }

        # Update interchange stations
        for station_name, lines in interchange_stations.items():
            try:
                station = MetroStation.objects.get(name=station_name)
                station.is_interchange = True
                station.save()
                self.stdout.write(f"Updated {station_name} as interchange station")
            except MetroStation.DoesNotExist:
                self.stdout.write(f"Warning: Station {station_name} not found")

        self.stdout.write(self.style.SUCCESS('Successfully populated metro stations and lines')) 